var now=new Date,days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day=days[now.getDay()];function AllowedHosts(){switch(window.location.hostname){case"www.slovenskenovice.si":case"slovenskenovice.si":return"Friday"==day;case"odprtakuhinja.delo.si":return"Thursday"==day;case"deloindom.delo.si":return"Wednesday"==day;case"onaplus.delo.si":return"Tuesday"==day;case"micna.slovenskenovice.si":return"Monday"==day;case"svetkapitala.delo.si":return"Saturday"==day;case"delo.si":case"www.delo.si":return"Sunday"==day;default:return!1}}function msieversion(){var e=window.navigator.userAgent;return!!/MSIE|Trident/.test(e)}if(!msieversion()&&AllowedHosts()){var loadScriptPromise=function(e){return new Promise(function(t,o){const n=document.createElement("script");n.type="text/javascript",n.onload=t,n.onerror=o,n.src=e,document.head.append(n)})};function loadScript(e,t){var o=document.createElement("script");o.type="text/javascript",o.readyState?o.onreadystatechange=function(){"loaded"!==o.readyState&&"complete"!==o.readyState||(o.onreadystatechange=null,t())}:o.onload=t,o.src=e,document.head.appendChild(o)}loadScriptPromise("https://static.delo.si/firebasejs/8.2.4/firebase-app.js").then(loadScript("https://static.delo.si/firebasejs/8.2.4/firebase-messaging.js")).then(loadScript("https://static.delo.si/firebasejs/8.2.4/firebase-analytics.js")).then(function(){var e="BCphtPbD7PwsthG1mcGYXl1v3Am7LWM5HW49fhqUxitnlGRAItor-jopvBmxPmSDj4G28FCfnePi_Ya2APNWpZ4";switch(window.localStorage.removeItem("firebaseconf"),window.location.hostname){case"slovenskenovice.si":case"www.slovenskenovice.si":portal="sn",portal_id="2",brandName="SLOVENSKENOVICE.SI",apple_identity="web.si.slovenskenovice.push";break;case"odprtakuhinja.delo.si":portal="ok",portal_id="4",brandName="ODPRTA KUHINJA",apple_identity="web.si.odprtakuhinja.push";break;case"deloindom.delo.si":portal="dd",portal_id="6",brandName="DELOINDOM",apple_identity="web.si.deloindom.push";break;case"onaplus.delo.si":portal="ona",portal_id="5",brandName="ONAPLUS",apple_identity="web.si.onaplus.push";break;case"micna.slovenskenovice.si":portal="micna",portal_id="7",brandName="MIČNA",apple_identity="web.si.micna.push";break;case"svetkapitala.delo.si":portal="sk",portal_id="8",brandName="SVET KAPITALA",apple_identity="web.si.svetkapitala.push";break;default:portal="delo",portal_id="1",brandName="DELO.SI",apple_identity="web.si.delo.push"}var t="https://push.delo.si/services/notification/"+portal+"/apikey/",o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n="//push.delo.si/services/notification/",i="https://push.delo.si/services/notification/"+portal+"/ios";console.log("Firebase "+brandName),console.log("DEBUGGING "+window.location.hostname);var a=document.createElement("style");a.type="text/css",a.innerText=".btn-cancel{float:left;border-color:white;padding: .75em 1.5em;font-size: 1em;border-radius: .25em;font-weight: 400;box-shadow: unset;display: -ms-flexbox;display: flex;cursor:pointer;box-shadow: none;background: #fff!important;color: #0078d1!important;}.btn-submit{cursor:pointer;border-color:#0078d1;background: #0078d1;color: #fff!important;transition: 75ms linear;padding: .75em 1.5em;font-size: 1em;border-radius: .25em;font-weight: 400;box-shadow: unset;display: -ms-flexbox;display: flex;}.button-holder{float:right;display:inline-block;margin-top:10px;width:auto;text-transform: uppercase;line-height: 1.5;text-align:right; padding:9px;}.icon-holder{float:left;width:50px;padding:10px;margin-right:10px;}.text-holder{padding:10px;}@keyframes slideDownEnter {0% {transform: translateY(-150%); }100% {transform: translateY(0); } }.fire-modal{font-family: 'Open Sans',sans-serif;display: none;position: fixed;z-index: 10000;left: 0;top: 0;width: 100%;height: 100%;overflow: auto;background-color: rgb(0,0,0);background-color: rgba(0,0,0,0.4); padding:0px;}.fire-modal-content {display: table;-webkit-animation-name: slideDownEnter;-webkit-animation-iteration-count: 1;-webkit-animation-timing-function: ease-out;-webkit-animation-duration: 400ms;-webkit-animation-fill-mode: forwards;animation-name: slideDownEnter;animation-iteration-count: 1;animation-timing-function: ease-out;animation-duration: .4s;animation-fill-mode: forwards;background-color: #fefefe;margin: 0% auto;padding: 6px;width: auto;border-radius: 13px;}.fire-close {  color: #aaa;  float: right;  font-size: 16px;  font-weight: bold;}.fire-close:hover,.fire-close:focus {  color: black;  text-decoration: none;  cursor: pointer;}",document.head.appendChild(a);var s=document.createElement("div");s.className="fire-modal",s.id="fireModal";var r=document.createElement("div");r.className="fire-modal-content";var l=document.createElement("span");l.className="fire-close",l.innerHTML+="&times;";var d=document.createElement("div");d.className="icon-holder",d.innerHTML='<img src="https://push.delo.si/static/notification/icon/push-icon.png" width="48" />';var c=document.createElement("div");c.className="text-holder";var p=document.createElement("p");p.className="fire-p-content",p.innerHTML+="Ali želite prejemati obvestila na portalu "+brandName+"?",c.appendChild(p);var m=document.createElement("div");m.id="fireBtn",m.className="btn-submit",m.innerHTML+="Nadaljuj";var u=document.createElement("div");u.id="closeBtn",u.className="btn-cancel",u.innerHTML+="Ne Hvala";var f=document.createElement("div");function w(e){var t=new Date;t.setDate(t.getDate()+e),window.localStorage.setItem("fcmReconfirm",new Date(t)),null!==window.localStorage.getItem("initFirebase")&&window.localStorage.removeItem("initFirebase")}function g(e,t,o){o=o||null;var n=JSON.stringify(o);return new Promise(function(o,i){var a=new XMLHttpRequest;a.open(e,t),a.onload=function(){4!=this.readyState||200!=this.status&&304!=this.status?i({status:this.status,statusText:a.statusText}):o(a.response)},a.onerror=function(){i({status:this.status,statusText:a.statusText})},a.setRequestHeader("Access-Control-Allow-Origin","https://"+window.location.hostname),a.setRequestHeader("Content-type","application/json; charset=utf-8"),a.send(n)})}function h(e){if(console.log(e),!function(){if(null===window.localStorage.getItem("sentToServerOn"))return!1;return new Date(window.localStorage.getItem("sentToServerOn"))>new Date}()){console.log("Sending token to server..."),console.log(e),v(!0);var t={token:e,topic_id:portal_id};g("PUT",n+"token/",t)}}function b(e){console.log("FCM: resetUI"),e.getToken().then(function(e){console.log(e);var t=window.localStorage.getItem("fcmReconfirm");!!t&&new Date;e?(console.log("Token avaliable."),h(e)):(console.log("No Instance ID token available. Request permission to generate one."),v(!1))}).catch(function(e){console.log("An error occurred while retrieving token. ",e),v(!1)})}function v(e){if(window.localStorage.setItem("sentToServer",e?1:0),e){var t=new Date;t.setMinutes(t.getMinutes()+10),window.localStorage.setItem("sentToServerOn",new Date(t))}}f.className="button-holder",f.appendChild(u),f.appendChild(m),r.appendChild(l),r.appendChild(d),r.appendChild(c),r.appendChild(f),s.appendChild(r),document.body.appendChild(s),window.onclick=function(e){e.target==s&&(s.style.display="none",w(30),o&&k())},u.onclick=function(){s.style.display="none",w(30),o&&k()},l.onclick=function(){s.style.display="none",w(30),o&&k()},m.onclick=function(){if(console.log("Clicked"),o){var e=window.safari.pushNotification.permission(apple_identity);y(e)}else!function(e){g("GET",t,null).then(function(t){if(t=JSON.parse(t),!firebase.apps.length){console.log("initializeApp for reseting UI");firebase.initializeApp(t);firebase.analytics()}var o=window.localStorage.getItem("fcmReconfirm"),n=!0;o&&(n=new Date(o)<=new Date);const i=firebase.messaging();Notification.requestPermission().then(function(t){"granted"===t?b(i):n&&(console.log("Pozdravljeni, če želite prejemati obvestila portala DELO.SI, kliknite na spodnjo povezavo."),window.localStorage.removeItem("fcmReconfirm"),w(e),p.innerHTML="Ali želite prejemati obvestila na portalu "+brandName+"?",s.style.display="block")}).catch(function(t){console.log("Unable to get permission to notify.",t),w(e)})}).catch(function(e){console.error("Firebase issue:",e)})}(30);s.style.display="none"};var y=function(e){console.log("invoke Permission SAFARI"),"default"===e.permission?(console.log("request Permission SAFARI"),window.safari.pushNotification.requestPermission(i,apple_identity,{topic_id:portal_id},y)):"granted"===e.permission&&h(e)};function k(){modalEl.style.display="none"}!function(){console.log("initPermission"),function(){if(null===window.localStorage.getItem("pageCount"))window.localStorage.setItem("pageCount",1);else if(null!==window.localStorage.getItem("pageCount"))if(window.localStorage.getItem("pageCount")>=3)window.localStorage.setItem("initFirebase",1),window.localStorage.removeItem("pageCount");else{var e=+window.localStorage.getItem("pageCount")+1;window.localStorage.setItem("pageCount",e)}}();var n=window.localStorage.getItem("fcmReconfirm"),i=!0;if(n&&(i=new Date(n)<=new Date),o&&"safari"in window&&"pushNotification"in window.safari){if(null!==window.localStorage.getItem("initFirebase")&&1==i){var a=window.safari.pushNotification.permission(apple_identity);"default"===a.permission?null!==window.localStorage.getItem("initFirebase")&&1==i&&(p.innerHTML="Ali želite prejemati obvestila na portalu "+brandName+"?",s.style.display="block",window.localStorage.removeItem("fcmReconfirm")):"granted"===a.permission&&(window.localStorage.removeItem("fcmReconfirm"),h(a))}}else g("GET",t,null).then(function(t){if(console.log("Firebase Delo 2.0"),t=JSON.parse(t),window.Notification||window.webkitNotifications||navigator.mozNotification){firebase.apps.length||(console.log("initializeApp"),firebase.initializeApp(t),firebase.analytics());const o=firebase.messaging();o.usePublicVapidKey(e),"default"===Notification.permission?null!==window.localStorage.getItem("initFirebase")&&1==i&&(p.innerHTML="Ali želite prejemati obvestila na portalu "+brandName+"?",s.style.display="block"):"granted"===Notification.permission&&(function(e,t){var o;o=e,function(e,t){var o=document.createElement("script");o.async=1,o.src=e;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}("https://static.delo.si/firebasejs/8.2.4/firebase-performance-standalone.js"),window.onload=function(){firebase.apps.length||firebase.initializeApp(o).performance()},t.onTokenRefresh(function(){console.log("On Token refresh."),t.getToken().then(function(e){console.log("Token refreshed."),console.log(e),v(!1),h(e),b(t)}).catch(function(e){console.log("Unable to retrieve refreshed token ",e)})})}(t,o),b(o))}})}()}).catch(function(){console.error("Firebase Error.")})}